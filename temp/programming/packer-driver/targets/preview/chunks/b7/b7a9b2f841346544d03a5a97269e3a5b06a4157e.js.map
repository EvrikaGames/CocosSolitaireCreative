{"version":3,"sources":["file:///D:/Cocos/CocosSolitaireCreative/assets/scripts/solitaire/Card.ts"],"names":["_decorator","Component","find","Label","Node","Vec3","tween","UITransform","Quat","GameController","ccclass","property","Card","num","cardData","initialPosition","isSelected","isRevealed","init","label","string","letter","back","active","revealed","node","position","backYellow","reveal","hide","onEnable","on","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onDisable","off","event","index","emit","VARIANTS_UPDATED","game","getComponentInChildren","closestSlot","moveCardToWord","getComponent","moveTo","targetWorldPos","parentUI","parent","console","warn","localTarget","convertToNodeSpaceAR","to","eulerAngles","rotationAngle","start","moveToCompleteWord","worldPos","localPos","scale","ZERO","call","removeCard","destroy","returnCardToPosition","setRotation","getLetter","setNum","getNumber"],"mappings":"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","sourcesContent":["import { _decorator, Component, find, Label, Node, Vec3, Event, EventTouch, Canvas, tween, UITransform, Quat } from 'cc';\r\nimport { ICardData } from './ICardData';\r\nimport GameController from './GameController';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass\r\nexport default class Card extends Component {\r\n    @property(Label)\r\n    label: Label = null;\r\n\r\n    @property(Node)\r\n    back: Node = null;\r\n\r\n    @property(Node)\r\n    backYellow: Node = null;\r\n\r\n    num: number;\r\n\r\n    private cardData: ICardData;\r\n    private initialPosition: Vec3;\r\n    isSelected: boolean = false;\r\n    isRevealed: boolean = false;\r\n\r\n    @property\r\n    rotationAngle: number = 360;\r\n\r\n\r\n    init(cardData: ICardData) {\r\n        this.cardData = cardData;\r\n        this.label.string = cardData.letter;\r\n        this.back.active = !cardData.revealed; \r\n        this.isRevealed = cardData.revealed; \r\n        this.initialPosition = new Vec3(this.node.position);\r\n        this.backYellow.active = false;\r\n\r\n        \r\n    }\r\n\r\n    reveal() {\r\n        this.back.active = false;\r\n        this.isRevealed = true;\r\n    }\r\n    hide(){\r\n        this.back.active = true;\r\n        this.isRevealed = false;\r\n    }\r\n\r\n    onEnable() {\r\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        //this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n\r\n    onDisable() {\r\n        this.node.off(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n        //this.node.off(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.node.off(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.node.off(Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n\r\n    onTouchStart(event: EventTouch) {\r\n        \r\n    }\r\n\r\n    /*onTouchMove(event: EventTouch) {\r\n        const delta = event.getDelta();\r\n        this.node.setPosition(this.node.position.add(delta.toVec3()));\r\n    }*/\r\n\r\n    onTouchEnd(event) {\r\n        if(this.isRevealed){\r\n            const index = event.index;\r\n            this.node.emit(GameController.VARIANTS_UPDATED, {index: index});\r\n            //this.node.emit(GameController.VARIANT_SELECTED, {index: index});\r\n            const game = find('Canvas').getComponentInChildren('GameController') as  GameController;\r\n            const closestSlot = game.moveCardToWord(this.node.getComponent(Card));\r\n        }\r\n    }\r\n    moveTo(targetWorldPos: Vec3){\r\n        const parentUI = this.node.parent.getComponent(UITransform);\r\n        if (!parentUI) {\r\n            console.warn(\"Родительский узел не содержит UITransform\");\r\n            return;\r\n        }\r\n        const localTarget = parentUI.convertToNodeSpaceAR(targetWorldPos);\r\n        tween(this.node)\r\n            .to(0.2, {\r\n                position: localTarget,\r\n                eulerAngles: new Vec3(0, 0, -this.rotationAngle)\r\n            })\r\n            .start();\r\n        this.backYellow.active = false;\r\n    }\r\n\r\n    moveToCompleteWord(worldPos: Vec3){\r\n        const localPos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(worldPos);\r\n\r\n        tween(this.node)\r\n            .to(1, { position: localPos })\r\n            .to(1, { scale: Vec3.ZERO })\r\n            .call(() => {\r\n                this.removeCard();\r\n            })\r\n            .start();\r\n\r\n    }\r\n\r\n    removeCard(){this.node.destroy();}\r\n    returnCardToPosition(){\r\n        this.node.setRotation(new Quat(0, 0, 0));\r\n        tween(this.node)\r\n            .to(0.2, {\r\n                position: this.initialPosition,\r\n            })\r\n            .start();\r\n        this.backYellow.active = false;\r\n        \r\n    }\r\n    getLetter(){return this.cardData.letter;}\r\n    setNum(num: number){this.num = num;}\r\n    getNumber(){return this.num;}\r\n}\r\n"]}